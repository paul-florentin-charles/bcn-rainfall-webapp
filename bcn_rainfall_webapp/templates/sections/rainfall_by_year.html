{% extends "layout.html" %}

{% block body %}

<div class="pure-g">
    <div class="pure-u-1 flex-center">
        <div class="plotly-graph" id="chart_rainfall_by_year"></div>
    </div>
</div>

<div class="pure-g">
    <div class="pure-u-1 flex-center">
        <div class="pure-button-group" role="group" aria-label="...">
            <button class="pure-button pure-button-disabled">Display</button>
            <button class="pure-button pure-button-primary" onclick="displayClusters(2);">2 clusters</button>
            <button class="pure-button pure-button-primary" onclick="displayClusters(3);">3 clusters</button>
            <button class="pure-button" onclick="displayClusters(1);">Reset</button>
        </div>
    </div>
</div>

<div class="pure-g">
    <div class="pure-u-1 flex-center">
        <div class="plotly-graph" id="chart_monthly_rainfalls"></div>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script type='text/javascript'>
    var graph_rainfall_by_year_list = {{ plotlyRainfallByYearJSONList|safe }}

    const graph_div_id_to_graph_json = {
        chart_rainfall_by_year: JSON.parse(graph_rainfall_by_year_list[0]),
        chart_monthly_rainfalls: {{ plotlyMonthlyRainfallsJSON|safe }},
    };

    ['load', 'resize'].forEach(event => window.addEventListener(event, function () {
        if (window.screen.width < 768) {
            Object.values(graph_div_id_to_graph_json).forEach((graph_json) => {
                graph_json.layout.font.size = 8;
                graph_json.layout.margin = {'t': 65, 'r': 15, 'b': 25, 'l': 25};
            })
        } else {
            Object.values(graph_div_id_to_graph_json).forEach((graph_json) => {
                graph_json.layout.font.size = 11;
                graph_json.layout.margin = {'t': 65, 'r': 30, 'b': 45, 'l': 65};
            })
        }
        Object.entries(graph_div_id_to_graph_json).forEach(([graph_div_id, graph_json]) => {
            Plotly.react(graph_div_id, graph_json, {}, config);
        })
    }))

    var style = window.getComputedStyle(document.body)

    Object.entries(graph_div_id_to_graph_json).forEach(([graph_div_id, graph_json]) => {
        document.getElementById(graph_div_id).addEventListener("mouseover", function () {
            graph_json.layout.font.color = style.getPropertyValue('--link-hover-color');

            Plotly.react(graph_div_id, graph_json, {}, config);
        })

        document.getElementById(graph_div_id).addEventListener("mouseout", function () {
            graph_json.layout.font.color = style.getPropertyValue('--link-color');

            Plotly.react(graph_div_id, graph_json, {}, config);
        })
    })

    function displayClusters(n_clusters) {
        var graphRainfallByYearNClusters = JSON.parse(graph_rainfall_by_year_list[n_clusters - 1]);

        if (window.screen.width < 768) {
            graphRainfallByYearNClusters.layout.font.size = 8;
            graphRainfallByYearNClusters.layout.margin = {'t': 65, 'r': 15, 'b': 25, 'l': 25};
        } else {
            graphRainfallByYearNClusters.layout.font.size = 11;
            graphRainfallByYearNClusters.layout.margin = {'t': 65, 'r': 30, 'b': 45, 'l': 65};
        }

        Plotly.react(chart_rainfall_by_year, graphRainfallByYearNClusters, {}, config);
    }
</script>

{% endblock %}